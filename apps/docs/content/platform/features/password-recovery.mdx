---
title: Password Recovery
description: Fluxo seguro de recupera√ß√£o de senha com link tempor√°rio e invalida√ß√£o de tokens.
date: 2026-01-11
author: Antigravity Agent
version: 1.0.0
tags: [auth, security, password, email]
---

# Password Requests

> Uma implementa√ß√£o segura para recupera√ß√£o de senhas baseada em tokens de curta dura√ß√£o.

## Vis√£o Geral

Este m√≥dulo gerencia o processo de redefini√ß√£o de senha quando um usu√°rio perde o acesso √† sua conta. Prioriza a seguran√ßa prevenindo enumera√ß√£o de usu√°rios e garantindo que links antigos sejam invalidados.

**Destaques de Seguran√ßa:**

- üõ°Ô∏è Tokens hash (SHA-256) armazenados no banco (nunca em texto plano)
- ‚è±Ô∏è Expira√ß√£o curta (1 hora)
- üö´ Preven√ß√£o de enumera√ß√£o (mensagens gen√©ricas de sucesso)
- üßπ Invalida√ß√£o autom√°tica de tokens anteriores ao usar um novo

## Fluxo T√©cnico

```mermaid
sequenceDiagram
    participant User
    participant API
    participant DB
    participant Email

    User->>API: POST /forgot-password (email)
    API->>DB: Busca usu√°rio (silencioso se n√£o achar)
    API->>DB: Store Hash(Token) + Expira√ß√£o
    API->>Email: Envia Token (Link) para usu√°rio
    User->>API: POST /reset-password (token, newPass)
    API->>DB: Busca Hash(Token) v√°lido
    API->>DB: Atualiza senha (Bcrypt) do usu√°rio
    API->>DB: Marca token como usado
    API->>DB: Invalida outros tokens do usu√°rio
```

## API Reference

### `requestReset(email)`

Inicia o processo de recupera√ß√£o.

**Comportamento:**

- Se o usu√°rio n√£o existir, retorna sucesso falso para evitar enumera√ß√£o.
- Se existir, gera token, salva hash e envia email.

**Exemplo:**

```typescript
// Retorna sempre mensagem de sucesso gen√©rica
const result = await passwordResetService.requestReset('user@example.com');
```

### `resetPassword(token, newPassword)`

Consome o token e atualiza a credencial.

**L√≥gica:**

1. Recria o hash SHA-256 do token recebido.
2. Busca no banco por token n√£o usado e n√£o expirado.
3. Hash da nova senha com Bcrypt (custo 10).
4. Invalida **todos** os tokens pendentes deste usu√°rio para seguran√ßa extra.

**Exemplo:**

```typescript
await passwordResetService.resetPassword(
  'raw_token_string_from_email',
  'NewSecurePassword123!',
);
```

## Security Best Practices

1. **Token Hashing:** O token enviado por email √© salvo apenas como hash no banco. Se o banco vazar, os tokens n√£o podem ser usados por atacantes.
2. **Generic Responses:** "If email exists, reset link sent" impede que atacantes descubram quais emails est√£o cadastrados.
3. **Token Rotation:** Ao resetar a senha, todos os outros tokens de reset pendentes s√£o invalidados.
