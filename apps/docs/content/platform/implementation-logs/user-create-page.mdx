---
title: "User Create Page Implementation"
description: Migrated from legacy docs
---

# User Management - Create User Page

## Overview

A página de criação de usuários (`/users/create`) é uma interface completa e moderna para adicionar novos usuários ao sistema, com funcionalidades avançadas de upload de avatar, autocomplete de endereço e validação de telefone internacional.

## Features Implementadas

### 1. Avatar Upload com Crop

**Componente**: `apps/admin/components/avatar-upload.tsx`

**Funcionalidades:**

- ✅ Drag & drop de imagens
- ✅ Click to upload
- ✅ Crop/recorte de imagem com zoom
- ✅ Preview em tempo real
- ✅ Validação de formato (jpg, jpeg, png, gif)
- ✅ Validação de tamanho (max 5MB)
- ✅ Botão para remover avatar

**Bibliotecas:**

- `react-dropzone` - Drag & drop
- `react-easy-crop` - Crop de imagem

**Uso:**

```tsx
<AvatarUpload
  value={avatarPreview}
  onChange={(file, preview) => {
    setAvatarFile(file);
    setAvatarPreview(preview);
  }}
/>
```

**Nota**: O upload real para o backend ainda precisa ser implementado. Atualmente apenas gera preview base64.

---

### 2. Address Autocomplete (Google Places)

**Componente**: `apps/admin/components/address-autocomplete.tsx`

**Funcionalidades:**

- ✅ Autocomplete global (funciona em qualquer país)
- ✅ Integração com Google Places API
- ✅ Auto-preenchimento de city, state, country, zipcode
- ✅ Fallback para Input normal se API key não configurada
- ✅ Loading state

**Configuração:**

1. Obter API Key do Google Maps:
   - Acesse [Google Cloud Console](https://console.cloud.google.com/)
   - Ative a **Places API**
   - Crie uma API Key

2. Configurar `.env.local`:

```bash
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=sua_api_key_aqui
```

**Uso:**

```tsx
<AddressAutocomplete
  value={watch('address') || ''}
  onChange={(value) => setValue('address', value)}
  onPlaceSelected={(place) => {
    setValue('city', place.city);
    setValue('state', place.state);
    setValue('country', place.country);
    setValue('zipcode', place.zipcode);
  }}
  placeholder="Enter address"
/>
```

---

### 3. Phone Input com Validação Internacional

**Componente**: `apps/admin/components/phone-input.tsx`

**Funcionalidades:**

- ✅ Seletor de país com bandeiras
- ✅ DDI automático baseado no país
- ✅ Padrão: Brasil (+55)
- ✅ Busca de países no dropdown
- ✅ Validação internacional (google-libphonenumber)
- ✅ Mensagem de erro apenas após interação
- ✅ Design system compliant

**Bibliotecas:**

- `react-international-phone` - UI do phone input
- `google-libphonenumber` - Validação

**Uso:**

```tsx
<PhoneInput
  value={watch('phone') || ''}
  onChange={(value) => setValue('phone', value)}
  placeholder="Enter phone number"
  error={errors.phone?.message}
  onValidationChange={(isValid) => {
    // Callback opcional para validação
  }}
/>
```

**Características do Dropdown:**

- Busca por nome do país, código ISO ou DDI
- Layout de 2 linhas:
  - Linha 1: Nome do país
  - Linha 2: ISO + DDI (ex: BR (+55))
- Flags grandes (36px altura)
- Scroll com max-height 300px

---

## Layout e Responsividade

### Desktop (lg+)

- **2 colunas independentes**:
  - Coluna esquerda (280px): Avatar + Email Verified Toggle
  - Coluna direita (flex): Formulário com campos

### Mobile/Tablet

- **1 coluna**: Todos os campos empilhados
- Grid responsivo nos campos: `sm:grid-cols-2`

### Estrutura:

```tsx
<div className="grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-8">
  {/* Coluna Esquerda */}
  <div className="border-r border-border/40">
    <AvatarUpload />
    <EmailVerifiedToggle />
  </div>

  {/* Coluna Direita */}
  <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
    {/* Campos do formulário */}
  </div>
</div>
```

---

## Validação de Formulário

**Schema Zod:**

```typescript
const userSchema = z.object({
  name: z.string().min(3, 'Nome deve ter no mínimo 3 caracteres'),
  email: z.string().email('Email inválido'),
  password: z.string().min(8, 'Senha deve ter no mínimo 8 caracteres'),
  phone: z.string().optional(),
  role: z.enum(['USER', 'TENANT_ADMIN']),
  status: z.enum(['ACTIVE', 'PENDING']).default('ACTIVE'),
  emailVerified: z.boolean().default(false),
  address: z.string().optional(),
  city: z.string().optional(),
  state: z.string().optional(),
  country: z.string().optional(),
  zipcode: z.string().optional(),
  company: z.string().optional(),
});
```

**Validações Especiais:**

- **Phone**: Validação internacional com `google-libphonenumber`
- **Email**: Validação de formato
- **Password**: Mínimo 8 caracteres

---

## Integração com Backend

**Mutation Hook**: `useCreateUser`

```typescript
const { mutate: createUser, isPending } = useCreateUser();

const onSubmit = async (data: UserFormData) => {
  try {
    // TODO: Upload avatar file to backend
    // const avatarUrl = await uploadAvatar(avatarFile);

    await createUser({
      ...data,
      // avatar: avatarUrl,
    });

    toast.success('User created successfully');
    router.push('/users');
  } catch (error) {
    toast.error('Failed to create user');
  }
};
```

**Endpoint**: `POST /api/users`

---

## Dependências

### Produção

```json
{
  "react-dropzone": "^14.3.5",
  "react-easy-crop": "^5.0.8",
  "@react-google-maps/api": "^2.20.3",
  "react-international-phone": "^4.6.1",
  "google-libphonenumber": "^3.2.43"
}
```

### Desenvolvimento

```json
{
  "@types/google-libphonenumber": "^7.4.30"
}
```

---

## Próximos Passos

### Backend

1. **Implementar endpoint de upload de avatar**
   - Armazenamento em S3/Cloud Storage
   - Retornar URL pública
   - Validação de tamanho/formato no backend

2. **Adicionar campo `avatar` no schema do Prisma**

```prisma
model User {
  // ...
  avatar String?
}
```

### Frontend

3. **Integrar upload de avatar no onSubmit**
4. **Adicionar loading state durante upload**
5. **Implementar edição de usuário** (reutilizar componentes)

---

## Troubleshooting

### Google Places não funciona

- Verifique se `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY` está configurada
- Confirme que Places API está ativada no Google Cloud
- Verifique restrições da API Key (domínios permitidos)

### Phone validation sempre inválido

- Certifique-se de incluir o DDI completo (ex: +5511999999999)
- Verifique se `google-libphonenumber` está instalado
- Teste com números conhecidos válidos

### Avatar não salva

- Implementação de upload ainda pendente
- Atualmente apenas gera preview local

---

## Referências

- [react-dropzone](https://react-dropzone.js.org/)
- [react-easy-crop](https://github.com/ValentinH/react-easy-crop)
- [Google Places API](https://developers.google.com/maps/documentation/places/web-service)
- [react-international-phone](https://react-international-phone.vercel.app/)
- [google-libphonenumber](https://github.com/google/libphonenumber)
