---
title: FORM VALIDATION BUGS
description: Auto-migrated documentation
---

# Form Validation Bugs Fixed

## Overview

Critical bugs that broke React Hook Form validation after implementing autocomplete prevention.

## Bugs Fixed

### Bug #1: Custom Name Attributes Breaking React Hook Form

**Problem:**

```tsx
{...register('email')}
name="user_email_new"  // ← Overwrites name="email"
```

**Impact:**

- React Hook Form couldn't track fields
- Validation completely broken
- `touchedFields` didn't work
- No visual feedback

**Root Cause:**
`{...register('email')}` internally sets `name="email"`. Adding `name="user_email_new"` overwrites it, breaking RHF's field registration.

**Solution:**
Removed custom `name` attributes. Kept only honeypot fields which don't interfere with RHF.

**Commit:** `fix: CRITICAL - remove custom name attributes breaking React Hook Form`

---

### Bug #2: Readonly Trick Breaking Validation

**Problem:**

```tsx
<Input readOnly onFocus={(e) => e.target.removeAttribute('readonly')} />
```

**Impact:**

- React Hook Form didn't detect changes
- Validation didn't trigger
- Form state not updated

**Root Cause:**
`readOnly` attribute prevents React Hook Form from registering onChange events properly.

**Solution:**
Removed readonly trick. Used only techniques that don't interfere with RHF:

- Honeypot fields
- `autoComplete="new-password"`
- `data-lpignore="true"`

**Commit:** `fix: remove readonly trick that broke React Hook Form validation`

---

### Bug #3: Password Not Green After Blur

**Problem:**

```tsx
onBlur={() => setIsPasswordFocused(false)}
// Didn't call register('password').onBlur(e)
```

**Impact:**

- `touchedFields.password` not set
- Green border didn't appear after blur
- Validation state not updated

**Root Cause:**
Custom `onBlur` handler didn't call React Hook Form's internal `onBlur`, preventing field from being marked as "touched".

**Solution:**

```tsx
onBlur={(e) => {
  setIsPasswordFocused(false);
  register('password').onBlur(e);  // ← Critical
}}
```

**Commit:** `fix(admin/user): password green border on blur and auto-filled fields validation`

---

### Bug #4: Validation Mode Too Slow

**Problem:**

```typescript
mode: 'onBlur'; // Validation only on blur
```

**Impact:**

- No instant feedback while typing
- User had to click away to see validation
- Poor UX

**Solution:**

```typescript
mode: 'onChange'; // Instant validation
reValidateMode: 'onChange';
```

**Commit:** `fix: change validation mode to onChange for instant feedback`

---

## Autocomplete Prevention (Working Solution)

### What Works ✅

```tsx
{
  /* Honeypot fields - invisible to users */
}
<input
  type="email"
  name="email_fake"
  tabIndex={-1}
  autoComplete="off"
  style={{ position: 'absolute', left: '-9999px' }}
/>;

{
  /* Real field */
}
<Input
  {...register('email')}
  autoComplete="new-password"
  data-form-type="other"
  data-lpignore="true"
/>;
```

### What Doesn't Work ❌

- ❌ Custom `name` attributes (breaks RHF)
- ❌ `readOnly` trick (breaks validation)
- ❌ Removing `name` entirely (breaks RHF)

## Visual Validation

All fields now show proper visual feedback:

```tsx
className={cn(
  "bg-transparent transition-colors",
  errors.email && touchedFields.email && "border-red-500",
  !errors.email && touchedFields.email && watch('email') && "border-green-500"
)}
```

**States:**

- **Red border:** Invalid + touched
- **Green border:** Valid + touched + has value
- **Default:** Not yet validated

## Testing Checklist

- [x] Email validation works
- [x] Password validation works
- [x] PasswordValidator appears/hides correctly
- [x] Green borders appear after blur
- [x] Red borders appear on errors
- [x] Phone validation works
- [x] Address auto-fill shows green
- [x] City/State/Country/Zipcode show green when filled

## Related Commits

1. `fix(admin/user): improve visual validation for email and phone`
2. `fix: resolve TypeScript error in phone validation`
3. `fix: CRITICAL - remove custom name attributes breaking React Hook Form`
4. `fix: remove readonly trick that broke React Hook Form validation`
5. `fix: change validation mode to onChange for instant feedback`
6. `feat(admin/user): improve password validator UX and address validation`
7. `fix(admin/user): password green border on blur and auto-filled fields validation`

## Lessons Learned

1. **Never override `name` attribute** when using `{...register()}`
2. **Avoid `readOnly` trick** - it breaks form libraries
3. **Always call RHF's internal handlers** (onBlur, onChange)
4. **Use `onChange` mode** for better UX
5. **Honeypot fields** are the safest autocomplete prevention
