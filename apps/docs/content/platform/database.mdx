---
title: Database (Split-Schema)
description: Arquitetura de banco de dados escal√°vel e modular do Kaven
date: 2026-01-10
author: Chris + Claude Sonnet 4.5
version: 2.0.0
tags: [database, prisma, architecture, scalability]
---

# Database (Split-Schema)

O Kaven v2.0 introduz o conceito de **Split-Schema** para o Prisma. Esta arquitetura resolve o maior problema de boilerplates: como atualizar o "core" do banco de dados sem perder as altera√ß√µes customizadas do desenvolvedor.

## üèóÔ∏è Como funciona

O banco de dados n√£o √© definido por um √∫nico arquivo `.prisma`, mas sim por uma composi√ß√£o din√¢mica:

1.  **`schema.base.prisma`**: Localizado em `packages/database/prisma/`. Cont√©m as tabelas fundamentais (User, Token, Tenant, Setting, etc). **N√£o deve ser editado manualmente pelo desenvolvedor.**
2.  **`schema.extended.prisma`**: O seu playground. Aqui voc√™ adiciona os modelos espec√≠ficos do seu neg√≥cio (ex: `Product`, `Order`, `Invoice`).
3.  **`kaven db generate`**: O comando que une esses dois mundos.

## üîÑ Fluxo de Trabalho

### 1. Adicionando uma nova tabela

Abra o arquivo `packages/database/prisma/schema.extended.prisma` e adicione seu modelo:

```prisma
model MyAwesomeProduct {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
}
```

### 2. Gerando o Schema final

Execute o comando da CLI:

```bash
node kaven-cli/bin/kaven.js db generate
```

Isso gerar√° o arquivo `packages/database/prisma/schema.prisma`, que √© o arquivo que o Prisma realmente utiliza.

### 3. Executando a Migration

Agora voc√™ pode usar os comandos padr√£o do Prisma:

```bash
pnpm --filter database migrate:dev
```

## üí° Vantagens

- **Atualiza√ß√µes Seguras**: Quando lan√ßarmos uma nova vers√£o do Kaven com melhorias no `schema.base.prisma`, voc√™ s√≥ precisa atualizar esse arquivo e rodar o `generate`. Suas tabelas no `extended` estar√£o intactas.
- **Isolamento de Responsabilidade**: Fica claro o que pertence ao framework e o que pertence ao seu produto.
- **Automa√ß√£o**: O CLI cuida de toda a concatena√ß√£o e valida√ß√£o sint√°tica b√°sica.

> [!TIP]
> Use rela√ß√µes entre os modelos do `base` e do `extended` normalmente. O Prisma reconhecer√° as rela√ß√µes ap√≥s o merge dos arquivos.

## ‚ö†Ô∏è Limita√ß√µes e Cuidados

- **Nomes Duplicados**: N√£o defina modelos com o mesmo nome em ambos os arquivos, pois o merge falhar√°.
- **Enums**: Assim como os modelos, enums tamb√©m podem ser estendidos no arquivo `extended`.

## Relacionados

- [Kaven CLI](/platform/cli)
- [Backend Architecture](/platform/architecture/backend)
