---
title: Internationalization (i18n)
description: Sistema completo de internacionaliza√ß√£o com next-intl, suportando m√∫ltiplos idiomas, tradu√ß√µes type-safe e roteamento localizado
date: 2026-01-06
author: Chris + Claude Sonnet 4.5
version: 2.0.0
tags: [i18n, next-intl, translations, localization, routing]
---

# Internationalization (i18n)

> Sistema robusto de internacionaliza√ß√£o usando `next-intl` com suporte a pt-BR e EN, tradu√ß√µes type-safe e roteamento autom√°tico

## Vis√£o Geral

O Kaven Boilerplate implementa internacionaliza√ß√£o completa usando `next-intl`, uma biblioteca moderna para Next.js App Router que oferece:

- ‚úÖ **Roteamento localizado** autom√°tico (`/pt/dashboard`, `/en/dashboard`)
- ‚úÖ **Server-side rendering** com mensagens carregadas no servidor
- ‚úÖ **Type-safe translations** com autocomplete no IDE
- ‚úÖ **Detec√ß√£o autom√°tica** de idioma preferido do usu√°rio
- ‚úÖ **Suporte a interpola√ß√£o** de vari√°veis din√¢micas
- ‚úÖ **Namespace organization** para organizar tradu√ß√µes por feature

**Idiomas Suportados:**

- üáßüá∑ **Portugu√™s (pt-BR)** - Idioma padr√£o
- üá∫üá∏ **English (EN)** - Idioma secund√°rio

---

## Arquitetura

### Estrutura de Arquivos

```
apps/admin/
‚îú‚îÄ‚îÄ i18n/
‚îÇ   ‚îú‚îÄ‚îÄ request.ts          # Configura√ß√£o de mensagens (server-side)
‚îÇ   ‚îî‚îÄ‚îÄ routing.ts           # Configura√ß√£o de rotas e navega√ß√£o
‚îú‚îÄ‚îÄ messages/
‚îÇ   ‚îú‚îÄ‚îÄ pt.json             # Tradu√ß√µes em Portugu√™s
‚îÇ   ‚îî‚îÄ‚îÄ en.json             # Tradu√ß√µes em Ingl√™s
‚îú‚îÄ‚îÄ middleware.ts            # Middleware de detec√ß√£o de locale
‚îî‚îÄ‚îÄ app/
    ‚îî‚îÄ‚îÄ [locale]/           # Rotas localizadas
        ‚îú‚îÄ‚îÄ layout.tsx      # Provider de i18n
        ‚îî‚îÄ‚îÄ (dashboard)/    # P√°ginas do dashboard
```

### Fluxo de Funcionamento

```mermaid
sequenceDiagram
    participant User
    participant Middleware
    participant Server
    participant Client

    User->>Middleware: GET /dashboard
    Middleware->>Middleware: Detecta locale (pt/en)
    Middleware->>Server: Redirect /pt/dashboard
    Server->>Server: Carrega messages/pt.json
    Server->>Client: Renderiza com tradu√ß√µes
    Client->>Client: Hidrata com NextIntlClientProvider
```

---

## Componentes Principais

### 1. Middleware (`middleware.ts`)

O middleware √© o ponto de entrada para localiza√ß√£o. Ele intercepta **todas** as requisi√ß√µes e:

1. Detecta o idioma preferido do usu√°rio (via header `Accept-Language` ou cookie)
2. Redireciona rotas sem locale para a vers√£o localizada
3. Preserva o locale em todas as navega√ß√µes subsequentes

**Configura√ß√£o Cr√≠tica:**

```typescript
export const config = {
  // Match all pathnames EXCEPT:
  // - /api/* (APIs n√£o precisam de locale)
  // - /_next/* (arquivos internos do Next.js)
  // - /_vercel/* (arquivos do Vercel)
  // - files with extensions (favicon.ico, images, etc)
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)'],
};
```

> [!WARNING]
> **Nunca remova o matcher!** Sem ele, o middleware tentar√° processar APIs e arquivos est√°ticos, causando "blank screen" e erros de hidrata√ß√£o.

**Implementa√ß√£o:**

```typescript
import createMiddleware from 'next-intl/middleware';
import { routing } from './i18n/routing';

export default createMiddleware(routing);

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)'],
};
```

---

### 2. Request Configuration (`i18n/request.ts`)

Configura como as mensagens s√£o carregadas no servidor.

```typescript
import { getRequestConfig } from 'next-intl/server';
import { routing } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  let locale = await requestLocale;

  // Fallback para locale padr√£o se inv√°lido
  if (!locale || !routing.locales.includes(locale as 'pt' | 'en')) {
    locale = routing.defaultLocale;
  }

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  };
});
```

**Caracter√≠sticas:**

- ‚úÖ Carregamento din√¢mico de mensagens baseado no locale
- ‚úÖ Fallback autom√°tico para `pt` se locale inv√°lido
- ‚úÖ Type-safe com TypeScript

---

### 3. Routing Configuration (`i18n/routing.ts`)

Define a configura√ß√£o de roteamento e exporta wrappers de navega√ß√£o locale-aware.

```typescript
import { defineRouting } from 'next-intl/routing';
import { createNavigation } from 'next-intl/navigation';

export const routing = defineRouting({
  locales: ['pt', 'en'],
  defaultLocale: 'pt',
  localePrefix: 'always', // Sempre incluir /pt ou /en na URL
});

// Exportar wrappers que automaticamente incluem o locale
export const { Link, redirect, usePathname, useRouter } =
  createNavigation(routing);
```

**Wrappers Exportados:**

| Wrapper       | Uso                          | Exemplo                                    |
| ------------- | ---------------------------- | ------------------------------------------ |
| `Link`        | Links internos               | `<Link href="/dashboard">Dashboard</Link>` |
| `useRouter`   | Navega√ß√£o program√°tica       | `router.push('/settings')`                 |
| `usePathname` | Obter pathname atual         | `const path = usePathname()`               |
| `redirect`    | Redirecionamento server-side | `redirect('/login')`                       |

> [!IMPORTANT]
> **SEMPRE use estes wrappers** ao inv√©s de `next/link` ou `next/navigation` dentro de `app/[locale]`. Caso contr√°rio, o locale ser√° perdido na navega√ß√£o.

---

### 4. Client Provider (`app/[locale]/layout.tsx`)

O `NextIntlClientProvider` hidrata os componentes client-side com as mensagens carregadas no servidor.

```typescript
import { NextIntlClientProvider } from 'next-intl';
import { getMessages } from 'next-intl/server';

export default async function LocaleLayout({
  children,
  params: { locale },
}: {
  children: React.ReactNode;
  params: { locale: string };
}) {
  const messages = await getMessages();

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

---

## Estrutura de Mensagens

### Organiza√ß√£o por Namespace

As tradu√ß√µes s√£o organizadas em **namespaces** para facilitar manuten√ß√£o:

```json
{
  "Common": {
    "dashboard": "Dashboard",
    "actions": "A√ß√µes",
    "users": "Usu√°rios"
  },
  "Dashboard": {
    "title": "Dashboard {name}",
    "cards": {
      "totalUsers": "Usu√°rios Ativos"
    }
  },
  "Observability": {
    "title": "Observabilidade",
    "goldenSignals": {
      "latency": "Latency (p95)"
    }
  },
  "AuditLogs": {
    "title": "Logs de Auditoria",
    "table": {
      "columns": {
        "dateTime": "Data/Hora"
      }
    }
  }
}
```

**Conven√ß√µes de Nomenclatura:**

- **PascalCase** para namespaces (`Dashboard`, `AuditLogs`)
- **camelCase** para chaves (`totalUsers`, `dateTime`)
- **Nested objects** para organiza√ß√£o hier√°rquica
- **Interpola√ß√£o** com `{variableName}`

---

## Guia de Uso

### Server Components

Use `getTranslations` para componentes server-side:

```typescript
import { getTranslations } from 'next-intl/server';

export default async function DashboardPage() {
  const t = await getTranslations('Dashboard');

  return (
    <div>
      <h1>{t('title', { name: 'Admin' })}</h1>
      <p>{t('cards.totalUsers')}</p>
    </div>
  );
}
```

**Caracter√≠sticas:**

- ‚úÖ Async/await obrigat√≥rio
- ‚úÖ Mensagens carregadas no servidor (melhor performance)
- ‚úÖ SEO-friendly (conte√∫do renderizado no HTML)

---

### Client Components

Use `useTranslations` hook para componentes client-side:

```typescript
'use client';
import { useTranslations } from 'next-intl';

export function WelcomeMessage() {
  const t = useTranslations('Common');

  return <div>{t('welcome')}</div>;
}
```

**Caracter√≠sticas:**

- ‚úÖ Hook s√≠ncrono (sem await)
- ‚úÖ Mensagens hidratadas do servidor
- ‚úÖ Reativo a mudan√ßas de locale

---

### Interpola√ß√£o de Vari√°veis

Suporte a vari√°veis din√¢micas nas tradu√ß√µes:

**messages/pt.json:**

```json
{
  "Dashboard": {
    "greeting": "Ol√°, {name}!",
    "stats": "Voc√™ tem {count} {count, plural, one {usu√°rio} other {usu√°rios}}"
  }
}
```

**Uso:**

```typescript
const t = useTranslations('Dashboard');

// Simples
<h1>{t('greeting', { name: 'Jo√£o' })}</h1>
// Output: "Ol√°, Jo√£o!"

// Plural
<p>{t('stats', { count: 1 })}</p>
// Output: "Voc√™ tem 1 usu√°rio"

<p>{t('stats', { count: 5 })}</p>
// Output: "Voc√™ tem 5 usu√°rios"
```

---

### Navega√ß√£o Localizada

**Links Internos:**

```typescript
import { Link } from '@/i18n/routing';

// ‚úÖ CORRETO - Usa wrapper do i18n
<Link href="/dashboard">Dashboard</Link>
// Renderiza: /pt/dashboard ou /en/dashboard

// ‚ùå ERRADO - Perde o locale
import { Link } from 'next/link';
<Link href="/dashboard">Dashboard</Link>
// Renderiza: /dashboard (erro 404)
```

**Navega√ß√£o Program√°tica:**

```typescript
import { useRouter } from '@/i18n/routing';

function MyComponent() {
  const router = useRouter();

  const handleClick = () => {
    router.push('/settings'); // Automaticamente vira /pt/settings
  };

  return <button onClick={handleClick}>Ir para Settings</button>;
}
```

**Redirecionamento Server-Side:**

```typescript
import { redirect } from '@/i18n/routing';

export default async function Page() {
  const user = await getUser();

  if (!user) {
    redirect('/login'); // Automaticamente vira /pt/login
  }

  return <div>Welcome</div>;
}
```

---

## Adicionando Novo Idioma

### Passo 1: Criar Arquivo de Mensagens

```bash
# Criar novo arquivo de tradu√ß√µes
cp apps/admin/messages/pt.json apps/admin/messages/es.json
```

### Passo 2: Atualizar Configura√ß√£o

**`i18n/routing.ts`:**

```typescript
export const routing = defineRouting({
  locales: ['pt', 'en', 'es'], // ‚Üê Adicionar 'es'
  defaultLocale: 'pt',
  localePrefix: 'always',
});
```

### Passo 3: Traduzir Mensagens

Edite `messages/es.json` e traduza todas as chaves:

```json
{
  "Common": {
    "dashboard": "Panel de Control",
    "actions": "Acciones",
    "users": "Usuarios"
  }
}
```

### Passo 4: Testar

```bash
# Acessar URL com novo locale
http://localhost:3000/es/dashboard
```

---

## Adicionando Nova Tradu√ß√£o

### Passo 1: Adicionar Chave nos Arquivos JSON

**`messages/pt.json`:**

```json
{
  "MyFeature": {
    "title": "Minha Feature",
    "description": "Descri√ß√£o da feature"
  }
}
```

**`messages/en.json`:**

```json
{
  "MyFeature": {
    "title": "My Feature",
    "description": "Feature description"
  }
}
```

### Passo 2: Usar no Componente

```typescript
const t = useTranslations('MyFeature');

<h1>{t('title')}</h1>
<p>{t('description')}</p>
```

---

## Troubleshooting

### Erro: "Blank Screen" ou Tela Branca

**Causa:** Middleware processando rotas que n√£o deveria (APIs, `_next`, etc)

**Solu√ß√£o:**

```typescript
// Verificar matcher no middleware.ts
export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)'],
};
```

---

### Erro: "Missing message" no Console

**Causa:** Chave de tradu√ß√£o n√£o existe no arquivo JSON

**Solu√ß√£o:**

1. Verificar se a chave existe em `messages/pt.json` e `messages/en.json`
2. Verificar se o namespace est√° correto
3. Reiniciar o dev server ap√≥s adicionar novas chaves

---

### Erro: Locale Perdido na Navega√ß√£o

**Causa:** Usando `next/link` ou `next/navigation` ao inv√©s dos wrappers

**Solu√ß√£o:**

```typescript
// ‚ùå ERRADO
import { Link } from 'next/link';

// ‚úÖ CORRETO
import { Link } from '@/i18n/routing';
```

---

### Erro: TypeScript n√£o Reconhece Tradu√ß√µes

**Causa:** Cache do TypeScript desatualizado

**Solu√ß√£o:**

```bash
# Limpar cache e reiniciar
rm -rf .next
pnpm dev
```

---

## Melhores Pr√°ticas

### ‚úÖ Fazer

- **Organize por namespace** - Agrupe tradu√ß√µes relacionadas
- **Use interpola√ß√£o** - Para textos din√¢micos
- **Mantenha consist√™ncia** - Mesma estrutura em todos os idiomas
- **Teste ambos os idiomas** - Sempre valide pt e en
- **Use wrappers de navega√ß√£o** - Sempre use `Link` e `useRouter` do i18n

### ‚ùå N√£o Fazer

- **Hardcode textos** - Nunca coloque textos direto no JSX
- **Misture idiomas** - N√£o misture pt e en no mesmo arquivo
- **Ignore namespaces** - N√£o coloque tudo em um √∫nico namespace
- **Use next/link direto** - Sempre use o wrapper do i18n
- **Esque√ßa de traduzir** - Sempre adicione em pt.json E en.json

---

## Relacionados

- [Design System - Typography](/design-system/foundation/typography)
- [Platform - Authentication](/platform/authentication)
- [Platform - Observability](/platform/guides/observability)
