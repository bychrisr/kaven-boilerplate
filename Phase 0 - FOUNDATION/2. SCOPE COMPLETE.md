# SCOPE COMPLETE - Kaven Boilerplate

> **Version:** 1.0.0  
> **Date:** December 16, 2025  
> **Author:** Chris (@bychrisr)  
> **Type:** Complete Scope Definition  
> **Status:** Foundation Phase

---

## üìã TABLE OF CONTENTS

1. [Scope Philosophy](https://claude.ai/chat/85762b85-c660-45f4-b12b-87d80239cb61#scope-philosophy)
2. [MVP Features (6 weeks)](https://claude.ai/chat/85762b85-c660-45f4-b12b-87d80239cb61#mvp-features)
3. [POST-MVP Features (8-12 weeks)](https://claude.ai/chat/85762b85-c660-45f4-b12b-87d80239cb61#post-mvp-features)
4. [FUTURE Features (v2.0+)](https://claude.ai/chat/85762b85-c660-45f4-b12b-87d80239cb61#future-features)
5. [Feature Phases Matrix](https://claude.ai/chat/85762b85-c660-45f4-b12b-87d80239cb61#feature-phases-matrix)
6. [Acceptance Criteria](https://claude.ai/chat/85762b85-c660-45f4-b12b-87d80239cb61#acceptance-criteria)
7. [Out of Scope](https://claude.ai/chat/85762b85-c660-45f4-b12b-87d80239cb61#out-of-scope)

---

## üéØ SCOPE PHILOSOPHY

### Core Principle

> "Document everything, build progressively, validate continuously."

**Kaven Boilerplate is:**

- ‚úÖ A **complete vision** documented upfront
- ‚úÖ A **phased execution** delivered iteratively
- ‚úÖ A **living product** that evolves based on feedback

**Kaven Boilerplate is NOT:**

- ‚ùå A "throw everything at the wall" approach
- ‚ùå A never-ending project without milestones
- ‚ùå A copy of existing products without differentiation

### The Three Scopes

1. **MVP (Minimum Viable Product)** - 6 weeks
    
    - Foundation that 80% of SaaS need
    - Production-ready, battle-tested, secure
    - Fully documented, tested, deployed
2. **POST-MVP (Feature Complete)** - 8-12 weeks
    
    - Advanced modules (CRM, Invoicing, Files, Chat)
    - Covers 95% of SaaS use cases
    - Optional packages (install what you need)
3. **FUTURE (Vision 2.0+)** - Roadmap
    
    - Innovation features (AI, Lightning, Mobile)
    - Community-driven priorities
    - Premium packages potential

---

## üöÄ MVP FEATURES (6 weeks)

### Objective

Deliver a **production-ready SaaS foundation** that enables founders to validate their idea in < 2 hours of setup.

### Success Criteria

- [ ] Developer can clone and run in < 10 minutes
- [ ] All MVP features 100% functional
- [ ] Test coverage > 80% (critical paths)
- [ ] Documentation covers 100% of MVP
- [ ] Security audit passed (OWASP Top 10)
- [ ] Performance targets met (< 200ms API, < 1s page load)

---

## 1. AUTHENTICATION & AUTHORIZATION (MVP)

### 1.1 Email/Password Authentication

**Features:**

- [x] User registration with email + password
- [x] Email uniqueness validation
- [x] Password strength requirements (min 8 chars, 1 uppercase, 1 number, 1 special)
- [x] Password hashing (bcrypt, cost factor 12)
- [x] Rate limiting on registration (3 attempts/hour per IP)

**Acceptance Criteria:**

- User can register with valid email + strong password
- Duplicate email returns clear error message
- Weak password rejected with specific feedback
- Registration endpoint protected by rate limiting

**API Endpoints:**

- `POST /api/auth/register`

---

### 1.2 Email Verification

**Features:**

- [x] Verification email sent on registration (async)
- [x] Magic link with expiring token (24h validity)
- [x] Account status: pending ‚Üí verified
- [x] Resend verification email option
- [x] Email template (HTML + plain text)

**Acceptance Criteria:**

- Verification email arrives within 30 seconds
- Clicking link verifies account
- Expired token shows clear error
- User can request new verification email

**API Endpoints:**

- `POST /api/auth/verify-email`
- `POST /api/auth/resend-verification`

---

### 1.3 Login & Session Management

**Features:**

- [x] Login with email + password
- [x] JWT access token (15 min expiry)
- [x] Refresh token (7 days expiry, stored in DB)
- [x] HTTP-only cookies for refresh token
- [x] Refresh token rotation (security)
- [x] Rate limiting on login (5 attempts/15min per IP)
- [x] "Remember me" option (30 days)

**Acceptance Criteria:**

- User can login with verified credentials
- Unverified email blocked from login
- Wrong password shows generic error (security)
- Refresh token rotates on each use
- Old refresh tokens invalidated

**API Endpoints:**

- `POST /api/auth/login`
- `POST /api/auth/refresh`
- `POST /api/auth/logout`

---

### 1.4 Two-Factor Authentication (2FA TOTP)

**Features:**

- [x] 2FA setup via QR code (Google Authenticator)
- [x] TOTP secret generation (32 chars)
- [x] Secret encryption (AES-256-CBC)
- [x] Backup codes (10 codes, one-time use, encrypted)
- [x] 2FA enforcement for admins (optional)
- [x] 2FA challenge on login (if enabled)
- [x] 2FA disable with password confirmation

**Acceptance Criteria:**

- User can enable 2FA via QR code
- Backup codes downloadable (PDF/CSV)
- 2FA required on login after setup
- Backup codes work once only
- Admin can enforce 2FA for all users

**API Endpoints:**

- `POST /api/auth/2fa/setup`
- `POST /api/auth/2fa/verify`
- `POST /api/auth/2fa/disable`
- `POST /api/auth/2fa/backup-codes`

---

### 1.5 Password Reset

**Features:**

- [x] Forgot password flow (email + token)
- [x] Reset token expiry (1 hour)
- [x] Rate limiting (3 requests/hour per email)
- [x] Password reset email template
- [x] New password validation (same rules as registration)
- [x] Invalidate all sessions on password change

**Acceptance Criteria:**

- User receives reset email within 30 seconds
- Reset link expires after 1 hour
- User can set new password via link
- All sessions invalidated on reset
- Rate limiting prevents abuse

**API Endpoints:**

- `POST /api/auth/forgot-password`
- `POST /api/auth/reset-password`

---

### 1.6 Role-Based Access Control (RBAC)

**Features:**

- [x] Predefined roles: SUPER_ADMIN, TENANT_ADMIN, USER
- [x] Permission system (CRUD per resource)
- [x] Role assignment per tenant (UserTenant junction)
- [x] Permission middleware (backend authorization)
- [x] Conditional UI rendering (frontend authorization)
- [x] Audit logs for role changes

**Acceptance Criteria:**

- Super Admin has global access
- Tenant Admin has tenant-scoped access
- User has limited access (own data only)
- Unauthorized requests return 403 Forbidden
- UI hides inaccessible features

**Database Models:**

- `Role` (id, name, permissions)
- `UserTenant` (userId, tenantId, role)

---

## 2. MULTI-TENANCY (MVP)

### 2.1 Multi-Tenant Architecture "Camale√£o"

**Core Philosophy:**

> "Build as Multi-tenant, use as Single-tenant"

**Features:**

- [x] Tenant model (organization/workspace)
- [x] User-Tenant association (many-to-many via UserTenant)
- [x] Tenant-less users support (nullable tenantId)
- [x] APP_MODE flag (MULTI vs SINGLE)
- [x] Middleware tenant detection (subdomain or fixed)
- [x] Row-Level Security via Prisma middleware
- [x] Automatic tenant context injection

**Acceptance Criteria:**

- MULTI mode: Different subdomains ‚Üí Different tenants
- SINGLE mode: All requests ‚Üí Same tenant (id=1)
- Tenant-less users can exist (Super Admin)
- All queries auto-filter by tenantId (except Super Admin)
- Data isolation verified (tenant A cannot see tenant B data)

**Database Models:**

- `Tenant` (id, name, slug, status, settings)
- `UserTenant` (userId, tenantId, role)

---

### 2.2 Middleware "Camale√£o" Implementation

**MULTI Mode Logic:**

```typescript
// 1. Extract subdomain from request
const subdomain = req.hostname.split('.')[0];

// 2. Load tenant from database
const tenant = await prisma.tenant.findUnique({ 
  where: { slug: subdomain } 
});

// 3. Inject tenant context
req.tenantId = tenant.id;

// 4. All subsequent queries auto-filter
prisma.user.findMany({ where: { tenantId: req.tenantId } });
```

**SINGLE Mode Logic:**

```typescript
// 1. Ignore subdomain
// 2. Use fixed tenant ID from environment
req.tenantId = process.env.DEFAULT_TENANT_ID || 1;

// 3. Queries work transparently
prisma.user.findMany({ where: { tenantId: req.tenantId } });
```

**Acceptance Criteria:**

- Middleware runs before ALL routes
- Tenant context available in all controllers
- Invalid subdomain returns 404 Tenant Not Found
- SINGLE mode never queries tenant table

**Environment Variables:**

- `APP_MODE` (MULTI or SINGLE)
- `DEFAULT_TENANT_ID` (used in SINGLE mode)
- `TENANT_DETECTION` (subdomain, header, or path)

---

### 2.3 Prisma Row-Level Security (RLS)

**Features:**

- [x] Prisma middleware auto-injects WHERE tenantId
- [x] Applies to: findMany, findFirst, update, delete
- [x] Bypass for Super Admin (global access)
- [x] Security layer redundancy (middleware + Prisma)

**Implementation:**

```typescript
prisma.$use(async (params, next) => {
  const tenantId = getCurrentTenantId(); // From request context
  const isSuperAdmin = isSuperAdminUser(); // From JWT

  // Skip RLS for Super Admin
  if (isSuperAdmin) return next(params);

  // Auto-inject tenant filter
  if (params.action === 'findMany' || params.action === 'findFirst') {
    params.args.where = {
      ...params.args.where,
      tenantId: tenantId
    };
  }

  return next(params);
});
```

**Acceptance Criteria:**

- User A (tenant 1) cannot see User B (tenant 2) data
- Super Admin can query across all tenants
- Middleware verified with integration tests
- Performance impact < 5ms per query

---

### 2.4 Tenant Management

**Features:**

- [x] Tenant CRUD (Create, Read, Update, Delete)
- [x] Tenant status (ACTIVE, SUSPENDED, DELETED)
- [x] Tenant suspension (blocks all users)
- [x] Tenant settings (JSON field for customization)
- [x] Tenant analytics (user count, storage usage)

**Acceptance Criteria:**

- Super Admin can create/edit/delete tenants
- Suspended tenant blocks all logins
- Tenant settings extensible per SaaS
- Tenant slug unique (for subdomain routing)

**API Endpoints:**

- `GET /api/tenants` (Super Admin only)
- `POST /api/tenants` (Super Admin only)
- `PUT /api/tenants/:id` (Super Admin only)
- `DELETE /api/tenants/:id` (Super Admin only)

---

### 2.5 Upgrade Path: Single ‚Üí Multi

**Scenario:** Customer starts with SINGLE mode (one company), later wants MULTI mode (resell to clients).

**Migration Steps:**

```bash
# 1. Change environment variable
APP_MODE=SINGLE ‚Üí APP_MODE=MULTI

# 2. Create additional tenants via UI
# 3. Assign users to new tenants
# 4. Configure DNS (subdomain routing)

# No code changes required!
```

**Acceptance Criteria:**

- Existing data preserved (tenantId=1 stays intact)
- New tenants created without migration scripts
- Users can switch between tenants (multi-tenant users)

---

## 3. ADMIN PANEL (MVP)

### 3.1 Dashboard Pages

#### General Dashboard

**Features:**

- [x] KPI cards (Total Users, Active Users, Revenue, Growth %)
- [x] User growth chart (line chart, 30 days)
- [x] Recent activity table (last 10 actions)
- [x] Quick actions (Create User, View Reports)

**Acceptance Criteria:**

- Dashboard loads in < 1 second
- Charts render with real data
- KPIs update in real-time (WebSocket optional)
- Responsive on mobile/tablet/desktop

---

#### Analytics Dashboard

**Features:**

- [x] Advanced charts (bar, donut, area)
- [x] Filters (date range, tenant, user type)
- [x] Export data (CSV, PDF)
- [x] Custom metrics (configurable per tenant)

**Acceptance Criteria:**

- Charts interactive (hover, click, zoom)
- Filters apply instantly (debounced)
- Export generates valid files

---

#### Banking Dashboard

**Features:**

- [x] Revenue metrics (MRR, ARR, Churn)
- [x] Payment charts (by method, by plan)
- [x] Subscription analytics (active, canceled, past due)
- [x] Financial reports (P&L, cash flow)

**Acceptance Criteria:**

- Financial data accurate (matches Stripe)
- Charts update on webhook events
- Currency formatting correct (BRL, USD)

---

#### Booking Dashboard

**Features:**

- [x] Upcoming appointments (calendar view)
- [x] Booking statistics (total, confirmed, canceled)
- [x] Availability management
- [x] Booking notifications

**Acceptance Criteria:**

- Calendar syncs with external calendars (Google, Outlook)
- Booking confirmation emails sent
- Timezone handling correct

---

### 3.2 Management Pages

#### User Management

**Pages:**

- [x] User List (table with filters, search, pagination)
- [x] User Create (form with validation)
- [x] User Edit (prefilled form)
- [x] User Profile (read-only view)
- [x] User Account Settings (password, 2FA, notifications)
- [x] User Cards (grid view, alternative to table)

**Features:**

- Search by name, email, role
- Filter by status (active, suspended, deleted)
- Bulk actions (suspend, delete, export)
- Pagination (20 users per page)
- Sort by columns (name, email, created date)

**Acceptance Criteria:**

- Table loads < 500ms (100 users)
- Search results instant (debounced)
- Bulk actions work for 100+ users
- Form validation prevents invalid data

**API Endpoints:**

- `GET /api/users`
- `POST /api/users`
- `PUT /api/users/:id`
- `DELETE /api/users/:id`

---

#### Tenant Management (Super Admin Only)

**Pages:**

- [x] Tenant List (table with filters)
- [x] Tenant Create (form)
- [x] Tenant Edit (form)
- [x] Tenant Analytics (usage metrics)

**Features:**

- Suspend/reactivate tenant
- View tenant users
- Storage usage per tenant
- Custom settings per tenant

**Acceptance Criteria:**

- Only Super Admin can access
- Tenant suspension blocks all users immediately
- Analytics accurate (user count, storage)

**API Endpoints:**

- `GET /api/tenants`
- `POST /api/tenants`
- `PUT /api/tenants/:id`
- `DELETE /api/tenants/:id`

---

#### Invoice Management

**Pages:**

- [x] Invoice List (table)
- [x] Invoice Details (view)
- [x] Invoice Create (form)
- [x] Invoice Edit (form)

**Features:**

- Invoice status (draft, sent, paid, overdue)
- PDF generation
- Email sending
- Payment tracking

**Acceptance Criteria:**

- Invoice PDF matches branding
- Email delivery < 10 seconds
- Payment status syncs with Stripe

**API Endpoints:**

- `GET /api/invoices`
- `POST /api/invoices`
- `PUT /api/invoices/:id`
- `POST /api/invoices/:id/send`

---

#### Order Management

**Pages:**

- [x] Order List (table)
- [x] Order Details (view)

**Features:**

- Order status (pending, processing, shipped, delivered)
- Status timeline
- Customer details
- Order items

**Acceptance Criteria:**

- Status updates trigger notifications
- Timeline shows all status changes
- Customer can track order (public link)

**API Endpoints:**

- `GET /api/orders`
- `GET /api/orders/:id`
- `PUT /api/orders/:id/status`

---

### 3.3 Authentication Pages

**Pages:**

- [x] Login (3 variations: Classic, Illustration, Cover)
- [x] Register
- [x] Forgot Password
- [x] Reset Password
- [x] Verify Email
- [x] 2FA Setup
- [x] 2FA Verify

**Features:**

- Form validation (real-time)
- Error messages (user-friendly)
- Loading states (spinner, disabled buttons)
- Success redirects
- "Remember me" checkbox
- Social login buttons (placeholder for OAuth)

**Acceptance Criteria:**

- All forms validate before submission
- Errors displayed inline (next to field)
- Success messages clear (toast notification)
- Mobile-responsive (tested on iPhone, Android)

---

### 3.4 Support Pages

**Pages:**

- [x] Settings (general, email, auth, theme)
- [x] Profile (view, edit)
- [x] Notifications (preferences, history)
- [x] Error pages (404, 500, Maintenance, Coming Soon)

**Features:**

- Settings saved per user (preferences)
- Profile photo upload (S3)
- Notification preferences (email, push, in-app)
- Custom error pages (branded)

**Acceptance Criteria:**

- Settings persist across sessions
- Profile photo under 2MB, valid formats (jpg, png)
- Error pages match brand theme

---

### 3.5 UI Components (shadcn/ui)

**Core Components:**

- [x] Button (variants: primary, secondary, outline, ghost)
- [x] Input (text, email, password, number)
- [x] Select (dropdown)
- [x] Checkbox
- [x] Radio
- [x] Switch (toggle)
- [x] Textarea
- [x] Form (React Hook Form integration)
- [x] Table (TanStack Table)
- [x] Dialog (modal)
- [x] Toast (notifications)
- [x] Card
- [x] Badge
- [x] Avatar
- [x] Skeleton (loading state)

**Custom Components:**

- [x] TableSkeleton (loading state for tables)
- [x] TableNoData (empty state)
- [x] Upload (drag & drop file upload)
- [x] LoadingScreen (full-page spinner)
- [x] ProgressBar (linear progress)

**Hooks:**

- [x] useTable (table state management)
- [x] useTabs (tab navigation)
- [x] useToggle (boolean state)
- [x] useDebounce (search optimization)

**Acceptance Criteria:**

- All components accessible (WCAG AA)
- Dark mode support
- Mobile-responsive
- TypeScript types complete

---

## 4. PAYMENTS & SUBSCRIPTIONS (MVP)

### 4.1 Stripe Integration

**Features:**

- [x] Stripe SDK setup
- [x] Customer creation (Stripe Customer)
- [x] Payment method management (cards)
- [x] Subscription plans (Basic, Pro, Enterprise)
- [x] Subscription creation
- [x] Subscription upgrade/downgrade
- [x] Subscription cancellation
- [x] Invoice generation (Stripe Invoice)
- [x] Webhook handler (payment events)

**Acceptance Criteria:**

- Customer created on registration
- Payment method saved securely (tokenized)
- Subscription activates immediately on payment
- Webhooks processed reliably (retry logic)
- Failed payments trigger dunning email

**API Endpoints:**

- `POST /api/payments/create-subscription`
- `POST /api/payments/cancel-subscription`
- `POST /api/payments/update-payment-method`
- `POST /api/webhooks/stripe`

---

### 4.2 Pix Integration (Brazilian Market)

**Features:**

- [x] Pix payment method (via Mercado Pago or similar)
- [x] Pix QR code generation
- [x] Pix payment confirmation (webhook)
- [x] Pix expiration (30 minutes default)
- [x] Pix refund support

**Acceptance Criteria:**

- QR code displays instantly
- Payment confirmed within 30 seconds of Pix transaction
- Expired Pix shows clear message
- Refunds processed within 24h

**API Endpoints:**

- `POST /api/payments/pix/create`
- `POST /api/payments/pix/check-status`
- `POST /api/webhooks/pix`

---

### 4.3 Subscription Management

**Features:**

- [x] View current plan
- [x] View billing history
- [x] Download invoices (PDF)
- [x] Update payment method
- [x] Cancel subscription (with retention flow)
- [x] Reactivate canceled subscription

**Acceptance Criteria:**

- User sees current plan details (price, features, renewal date)
- Billing history shows all invoices (paid, pending, failed)
- PDF invoices downloadable
- Cancellation requires confirmation (modal)

---

## 5. OBSERVABILITY (MVP)

### 5.1 Prometheus Metrics

**Metrics Collected:**

- [x] HTTP request count (by endpoint, status code)
- [x] HTTP request duration (histogram, p50/p95/p99)
- [x] Active users (gauge)
- [x] Database query count
- [x] Database query duration
- [x] Redis cache hit rate
- [x] Error rate (by type)

**Acceptance Criteria:**

- Metrics exposed at `/metrics` endpoint
- Prometheus scrapes every 15 seconds
- Custom metrics trackable (e.g., signup_count)

---

### 5.2 Grafana Dashboards

**Dashboards:**

- [x] System Dashboard (CPU, memory, disk, network)
- [x] Tenant Dashboard (users, storage, API calls per tenant)
- [x] Performance Dashboard (request latency, error rate)

**Acceptance Criteria:**

- Dashboards pre-configured (no manual setup)
- Graphs update in real-time
- Alerts configured (high error rate, slow queries)

---

### 5.3 Structured Logging (Winston)

**Log Levels:**

- [x] error (critical errors, exceptions)
- [x] warn (warnings, deprecated usage)
- [x] info (general info, startup)
- [x] debug (development debugging)

**Log Format:**

```json
{
  "timestamp": "2025-12-16T12:00:00Z",
  "level": "info",
  "message": "User logged in",
  "userId": "123",
  "tenantId": "456",
  "ip": "192.168.1.1",
  "userAgent": "Mozilla/5.0..."
}
```

**Acceptance Criteria:**

- All logs structured (JSON format)
- Logs include correlation ID (request tracing)
- Logs rotate daily (max 30 days retention)
- Log search works (grep, ELK stack)

---

### 5.4 Health Checks

**Endpoints:**

- [x] `/health` (basic liveness check)
- [x] `/ready` (readiness check: DB + Redis)

**Health Check Logic:**

```typescript
GET /health
Response: { status: "ok", timestamp: "..." }

GET /ready
Response: {
  status: "ready",
  database: "healthy",
  redis: "healthy",
  timestamp: "..."
}
```

**Acceptance Criteria:**

- `/health` always returns 200 (unless app crashed)
- `/ready` returns 503 if DB or Redis down
- Kubernetes uses `/ready` for readiness probe

---

## 6. DEVOPS (MVP)

### 6.1 Docker Compose

**Services:**

- [x] PostgreSQL 16 (database)
- [x] Redis 7 (cache)
- [x] Backend API (Fastify)
- [x] Frontend Admin (Next.js)
- [x] Prometheus (metrics)
- [x] Grafana (dashboards)

**Acceptance Criteria:**

- `docker-compose up` starts all services
- Services communicate (API ‚Üí DB ‚Üí Redis)
- Volumes persist data (DB, Redis, Grafana)
- Environment variables loaded from `.env`

---

### 6.2 GitHub Actions CI/CD

**Workflows:**

- [x] Test (runs on every PR)
- [x] Build (runs on merge to main)
- [x] Deploy (runs on tag creation)

**Test Workflow:**

```yaml
- Lint (ESLint, Prettier)
- Type check (TypeScript)
- Unit tests (Vitest)
- Integration tests (Supertest)
- E2E tests (Playwright)
- Coverage report (Codecov)
```

**Acceptance Criteria:**

- All tests pass before merge
- Coverage > 80% enforced
- Failed tests block merge

---

### 6.3 Database Migrations

**Features:**

- [x] Prisma migrations (version controlled)
- [x] Automatic migration on deploy
- [x] Rollback support (manual)
- [x] Seed script (demo data)

**Acceptance Criteria:**

- Migrations run automatically in CI/CD
- Seed script creates Super Admin + demo tenant
- Migrations reversible (down migrations)

---

## 7. SECURITY (MVP)

### 7.1 OWASP Top 10 Mitigations

**Implemented:**

- [x] A01: Broken Access Control ‚Üí RBAC + RLS
- [x] A02: Cryptographic Failures ‚Üí AES-256, bcrypt
- [x] A03: Injection ‚Üí Prisma (parameterized queries)
- [x] A04: Insecure Design ‚Üí Threat modeling done
- [x] A05: Security Misconfiguration ‚Üí CSP headers, CORS
- [x] A06: Vulnerable Components ‚Üí Dependabot alerts
- [x] A07: Authentication Failures ‚Üí 2FA, rate limiting
- [x] A08: Software & Data Integrity ‚Üí SRI, signed packages
- [x] A09: Logging Failures ‚Üí Structured logs + audit logs
- [x] A10: SSRF ‚Üí Input validation, allowlist

**Acceptance Criteria:**

- Security audit passes (manual review)
- Automated scans clean (Snyk, npm audit)

---

### 7.2 Rate Limiting

**Endpoints:**

- Login: 5 attempts / 15 minutes per IP
- Registration: 3 attempts / hour per IP
- Password reset: 3 attempts / hour per email
- API calls: 100 requests / 15 minutes per user

**Acceptance Criteria:**

- Rate limits enforced (Redis-backed)
- Clear error message when limit hit
- Limits configurable per endpoint

---

### 7.3 Audit Logs

**Logged Actions:**

- [x] User created/updated/deleted
- [x] Tenant created/updated/suspended
- [x] Role assigned/revoked
- [x] Settings changed
- [x] Payment events

**Log Fields:**

```typescript
{
  id: uuid,
  tenantId: uuid,
  userId: uuid,
  action: "user.created",
  entityType: "User",
  entityId: "123",
  changes: { email: "new@example.com" },
  ipAddress: "192.168.1.1",
  userAgent: "Mozilla...",
  createdAt: timestamp
}
```

**Acceptance Criteria:**

- All admin actions logged
- Audit log viewer in admin panel
- Logs filterable (by user, action, date)
- Logs exportable (CSV)

---

## üì¶ POST-MVP FEATURES (8-12 weeks)

### Objective

Expand Kaven into a **feature-complete boilerplate** covering 95% of SaaS use cases.

### Success Criteria

- [ ] All POST-MVP modules installable as packages
- [ ] Each module has 100% documentation
- [ ] Each module has 80%+ test coverage
- [ ] Modules work independently (no tight coupling)
- [ ] Community feedback incorporated

---

## 8. CRM MODULE (POST-MVP)

### 8.1 Lead Management

**Features:**

- [ ] Lead CRUD (Create, Read, Update, Delete)
- [ ] Lead import (CSV upload)
- [ ] Lead scoring (configurable rules)
- [ ] Lead assignment (manual or auto-assign)
- [ ] Lead status pipeline (new ‚Üí contacted ‚Üí qualified ‚Üí converted ‚Üí lost)
- [ ] Lead source tracking (website, referral, ad campaign)
- [ ] Lead tags (categorization)
- [ ] Lead notes (timeline)

**Database Models:**

- `Lead` (id, name, email, phone, company, score, status, source, assignedTo, tenantId)
- `LeadNote` (id, leadId, userId, content, createdAt)
- `LeadTag` (id, leadId, tag)

**API Endpoints:**

- `GET /api/crm/leads`
- `POST /api/crm/leads`
- `PUT /api/crm/leads/:id`
- `DELETE /api/crm/leads/:id`
- `POST /api/crm/leads/import`

---

### 8.2 Deal/Opportunity Management

**Features:**

- [ ] Deal CRUD
- [ ] Deal pipeline (stages: new ‚Üí active ‚Üí negotiation ‚Üí closed-won/lost)
- [ ] Deal value tracking (currency, amount)
- [ ] Close probability (%)
- [ ] Expected close date
- [ ] Deal owner (sales rep)
- [ ] Deal activities (calls, meetings, emails)
- [ ] Kanban view (drag-drop between stages)

**Database Models:**

- `Deal` (id, title, value, currency, stage, probability, closeDate, ownerId, leadId, tenantId)
- `DealActivity` (id, dealId, type, description, createdAt)

**API Endpoints:**

- `GET /api/crm/deals`
- `POST /api/crm/deals`
- `PUT /api/crm/deals/:id`
- `PUT /api/crm/deals/:id/stage`

---

### 8.3 Contact Management

**Features:**

- [ ] Contact CRUD
- [ ] Contact profiles (name, email, phone, company, role)
- [ ] Contact segmentation (tags, custom fields)
- [ ] Contact history (all interactions)
- [ ] Contact import/export (CSV)
- [ ] Duplicate detection

**Database Models:**

- `Contact` (id, name, email, phone, company, role, tenantId)
- `ContactInteraction` (id, contactId, type, description, createdAt)

---

### 8.4 Activity Tracking

**Features:**

- [ ] Email log (sent, received)
- [ ] Call log (duration, outcome)
- [ ] Meeting log (date, attendees, notes)
- [ ] Support ticket log
- [ ] Timeline view (chronological)

**Database Models:**

- `Activity` (id, type, contactId, leadId, dealId, description, createdAt)

---

### 8.5 Sales Pipeline Visualization

**Features:**

- [ ] Visual pipeline (Kanban board)
- [ ] Conversion rates (stage-to-stage)
- [ ] Sales targets (goals vs actual)
- [ ] Revenue trends (monthly, quarterly)
- [ ] Win/Loss analysis

**Acceptance Criteria:**

- Pipeline updates in real-time (WebSocket)
- Drag-drop changes stage (optimistic UI)
- Charts accurate (matches database)

---

## 9. INVOICE MANAGEMENT (POST-MVP)

### 9.1 Invoice Creation

**Features:**

- [ ] Invoice CRUD
- [ ] Line items (description, quantity, price)
- [ ] Taxes (configurable %, multiple taxes)
- [ ] Discounts (%, fixed amount)
- [ ] Invoice templates (customizable per tenant)
- [ ] Invoice numbering (sequential, customizable prefix)
- [ ] Multi-currency support

**Database Models:**

- `Invoice` (id, number, customerId, status, subtotal, tax, discount, total, currency, dueDate, tenantId)
- `InvoiceItem` (id, invoiceId, description, quantity, price)

**API Endpoints:**

- `GET /api/invoices`
- `POST /api/invoices`
- `PUT /api/invoices/:id`
- `DELETE /api/invoices/:id`

---

### 9.2 Recurring Invoices

**Features:**

- [ ] Subscription-based invoicing
- [ ] Recurring schedules (monthly, quarterly, yearly)
- [ ] Auto-generation on schedule
- [ ] Pro-ration logic
- [ ] Billing date customization

**Acceptance Criteria:**

- Invoices generated automatically (cron job)
- Customer notified via email
- Payment attempted automatically (if card on file)

---

### 9.3 Invoice Delivery & Tracking

**Features:**

- [ ] Email delivery (PDF attachment)
- [ ] Payment tracking (paid, pending, overdue)
- [ ] Payment reminders (auto-send before due date)
- [ ] Late fees (configurable % or fixed)
- [ ] Payment page (public link for customer)

**Acceptance Criteria:**

- Email sent within 10 seconds
- PDF matches tenant branding
- Payment page mobile-responsive
- Late fees calculated correctly

---

## 10. ORDER MANAGEMENT (POST-MVP)

### 10.1 Order Lifecycle

**Features:**

- [ ] Order creation
- [ ] Order status (pending ‚Üí processing ‚Üí shipped ‚Üí delivered ‚Üí completed)
- [ ] Status timeline (history of changes)
- [ ] Customer details
- [ ] Order items (products, quantities, prices)
- [ ] Shipping information
- [ ] Return/Refund handling

**Database Models:**

- `Order` (id, customerId, status, subtotal, shipping, tax, total, tenantId)
- `OrderItem` (id, orderId, productId, quantity, price)
- `OrderStatusHistory` (id, orderId, status, createdAt)

---

### 10.2 Fulfillment Management

**Features:**

- [ ] Fulfillment assignment (warehouse, team member)
- [ ] Packing slip generation (PDF)
- [ ] Shipping label generation (via carrier API)
- [ ] Tracking number integration
- [ ] Inventory deduction on fulfillment

**Acceptance Criteria:**

- Fulfillment triggers inventory update
- Customer receives tracking email
- Tracking link works (external carrier)

---

## 11. JOB MANAGEMENT (POST-MVP)

### 11.1 Job Posting

**Features:**

- [ ] Job CRUD
- [ ] Job details (title, description, requirements, salary)
- [ ] Job status (draft, published, closed)
- [ ] Job board (public-facing)
- [ ] Job application form (customizable)
- [ ] Job categories/tags

**Database Models:**

- `Job` (id, title, description, requirements, salary, status, tenantId)
- `JobApplication` (id, jobId, candidateId, status, appliedAt)

---

### 11.2 Applicant Tracking

**Features:**

- [ ] Application pipeline (applied ‚Üí screening ‚Üí interview ‚Üí offer ‚Üí hired/rejected)
- [ ] Candidate profiles (resume, portfolio, notes)
- [ ] Candidate scoring
- [ ] Bulk actions (reject, move stage)
- [ ] Email templates (rejection, interview invitation)

**Acceptance Criteria:**

- Pipeline drag-drop works (Kanban)
- Candidate notified on status change
- Resume parsing works (PDF, DOCX)

---

### 11.3 Interview Scheduling

**Features:**

- [ ] Interview creation (date, time, location, attendees)
- [ ] Calendar integration (Google Calendar, Outlook)
- [ ] Interview reminders (email, SMS)
- [ ] Interview notes (post-interview feedback)
- [ ] Interview scoring

**Acceptance Criteria:**

- Calendar invite sent to all attendees
- Reminders sent 24h + 1h before interview
- Notes saved and visible to hiring team

---

## 12. TOUR/BOOKING MANAGEMENT (POST-MVP)

### 12.1 Booking Creation

**Features:**

- [ ] Booking CRUD
- [ ] Booking types (call, demo, appointment, tour)
- [ ] Availability management (calendar slots)
- [ ] Booking confirmation (email)
- [ ] Booking reminders (24h, 1h before)
- [ ] Timezone handling (user timezone)

**Database Models:**

- `Booking` (id, type, customerId, startTime, endTime, status, tenantId)
- `Availability` (id, userId, dayOfWeek, startTime, endTime)

---

### 12.2 Calendar Integration

**Features:**

- [ ] Google Calendar sync (two-way)
- [ ] Outlook Calendar sync
- [ ] iCal export (subscribe link)
- [ ] Conflict detection (double-booking prevention)

**Acceptance Criteria:**

- External calendars synced within 5 minutes
- Bookings appear in external calendar
- Conflicts prevented automatically

---

### 12.3 Payment Integration

**Features:**

- [ ] Booking payment (upfront, deposit, or free)
- [ ] Payment link (sent with confirmation)
- [ ] Refund policy enforcement
- [ ] No-show handling

**Acceptance Criteria:**

- Payment processed before booking confirmed
- Refunds follow cancellation policy
- No-shows tracked (analytics)

---

## 13. FILE MANAGER (POST-MVP)

### 13.1 File Upload

**Features:**

- [ ] Drag & drop upload
- [ ] Multi-file upload
- [ ] File size limit (configurable per tenant)
- [ ] File type validation (whitelist)
- [ ] Upload progress bar
- [ ] S3 integration (AWS S3 or Cloudflare R2)

**Acceptance Criteria:**

- Files upload < 10 seconds (for 10MB file)
- Progress bar accurate
- Invalid file types rejected

**API Endpoints:**

- `POST /api/files/upload`
- `GET /api/files`
- `DELETE /api/files/:id`

---

### 13.2 File Preview

**Features:**

- [ ] Image preview (jpg, png, gif, webp)
- [ ] PDF preview (embedded viewer)
- [ ] Video preview (mp4, webm)
- [ ] Audio preview (mp3, wav)
- [ ] Document preview (docx, xlsx - via Google Docs Viewer)

**Acceptance Criteria:**

- Preview loads < 2 seconds
- Preview works on mobile
- Unsupported files show download button

---

### 13.3 File Organization

**Features:**

- [ ] Folder structure (tree view)
- [ ] Folder CRUD
- [ ] Move files between folders (drag-drop)
- [ ] File search (by name, type, date)
- [ ] File filters (type, size, date)

**Acceptance Criteria:**

- Folder tree renders < 1 second (1000 folders)
- Search results instant (< 500ms)
- Drag-drop updates folder immediately

---

### 13.4 File Sharing

**Features:**

- [ ] Public link generation (shareable URL)
- [ ] Link expiration (configurable)
- [ ] Password protection (optional)
- [ ] Download count tracking
- [ ] Access control per file (roles, permissions)

**Acceptance Criteria:**

- Public link works without login
- Expired links return 404
- Password-protected links require password

---

### 13.5 Storage Management

**Features:**

- [ ] Storage quota per tenant (configurable)
- [ ] Storage usage dashboard (total, by type)
- [ ] Quota alerts (80%, 100% full)
- [ ] File versioning (keep last 5 versions)
- [ ] Bulk delete (with confirmation)

**Acceptance Criteria:**

- Quota enforced (upload fails if exceeded)
- Usage dashboard accurate (matches S3)
- Versioning allows rollback

---

## 14. CHAT (POST-MVP)

### 14.1 Real-Time Messaging

**Features:**

- [ ] WebSocket connection (Socket.io)
- [ ] One-on-one chats
- [ ] Group chats (up to 50 members)
- [ ] Message threads (replies)
- [ ] Message editing (within 5 minutes)
- [ ] Message deletion (soft delete)
- [ ] Read receipts (seen by)
- [ ] Typing indicators

**Database Models:**

- `Chat` (id, type, name, tenantId)
- `ChatMember` (id, chatId, userId, role)
- `Message` (id, chatId, userId, content, editedAt, deletedAt, createdAt)

**API Endpoints:**

- `GET /api/chats` (REST, initial load)
- `ws://api/socket.io` (WebSocket, real-time)

---

### 14.2 File Sharing in Chat

**Features:**

- [ ] Image upload (inline preview)
- [ ] Document upload (PDF, DOCX, etc)
- [ ] File size limit (10MB per file)
- [ ] Virus scanning (ClamAV or similar)

**Acceptance Criteria:**

- Images preview inline (no download needed)
- Documents downloadable
- Virus detection blocks malicious files

---

### 14.3 Message Search

**Features:**

- [ ] Full-text search (by content)
- [ ] Filter by chat, sender, date
- [ ] Highlight matches (in results)
- [ ] Jump to message (scroll to context)

**Acceptance Criteria:**

- Search returns results < 1 second (10k messages)
- Highlights accurate
- Jump works (scrolls to correct position)

---

### 14.4 Emoji Reactions

**Features:**

- [ ] React to messages (üëç ‚ù§Ô∏è üòÇ üòÆ üò¢ üò°)
- [ ] View who reacted (tooltip)
- [ ] Remove reaction (click again)

**Acceptance Criteria:**

- Reactions appear instantly (optimistic UI)
- Reaction count accurate
- Multiple users can react

---

## 15. MAIL (POST-MVP)

### 15.1 Internal Inbox

**Features:**

- [ ] Inbox view (list of emails)
- [ ] Email threads (grouped by subject)
- [ ] Folders (inbox, sent, drafts, trash, custom)
- [ ] Labels (categorization, color-coded)
- [ ] Email search (full-text)
- [ ] Read/unread status
- [ ] Star/flag emails

**Database Models:**

- `Email` (id, from, to, subject, body, read, starred, folderId, tenantId)
- `EmailLabel` (id, emailId, label)

**API Endpoints:**

- `GET /api/mail/inbox`
- `GET /api/mail/sent`
- `POST /api/mail/send`
- `DELETE /api/mail/:id`

---

### 15.2 Compose Email

**Features:**

- [ ] Rich text editor (bold, italic, lists, links)
- [ ] Attachments (files from File Manager)
- [ ] Draft auto-save (every 10 seconds)
- [ ] Send immediately or schedule
- [ ] CC/BCC support
- [ ] Email templates (pre-written content)

**Acceptance Criteria:**

- Editor saves draft every 10 seconds
- Scheduled emails sent on time (cron job)
- Attachments under 25MB total

---

### 15.3 Email Signatures

**Features:**

- [ ] Signature editor (rich text)
- [ ] Multiple signatures (personal, work)
- [ ] Default signature per folder
- [ ] Signature preview (before send)

**Acceptance Criteria:**

- Signature appends automatically
- Multiple signatures selectable
- Preview accurate

---

### 15.4 Auto-Reply

**Features:**

- [ ] Auto-reply rules (conditions)
- [ ] Schedule (date range, time of day)
- [ ] Custom message
- [ ] Send once per sender (prevent loops)

**Acceptance Criteria:**

- Auto-reply sent within 1 minute
- Only sent once per sender
- Schedule enforced correctly

---

## 16. REFERRAL SYSTEM (POST-MVP)

### 16.1 Referral Link Generation

**Features:**

- [ ] Unique referral link per user
- [ ] Link customization (vanity slug)
- [ ] QR code generation (for print/mobile)
- [ ] Link preview (OG tags for social share)

**Database Models:**

- `Referral` (id, referrerId, refereeId, status, rewardEarned, createdAt)

**API Endpoints:**

- `GET /api/referrals/link`
- `POST /api/referrals/customize-link`

---

### 16.2 Tracking & Analytics

**Features:**

- [ ] Click tracking (unique visitors)
- [ ] Signup tracking (referred users)
- [ ] Conversion tracking (paid customers)
- [ ] Referral leaderboard (top referrers)
- [ ] Referral dashboard (clicks, signups, earnings)

**Acceptance Criteria:**

- Clicks tracked accurately (unique per IP)
- Conversions attributed correctly (cookie-based)
- Leaderboard updates daily

---

### 16.3 Reward Tiers

**Features:**

- [ ] Reward rules (Bronze: 3 signups, Silver: 10, Gold: 50)
- [ ] Reward types (% discount, fixed credit, cash payout)
- [ ] Automated payouts (Stripe Connect or PayPal)
- [ ] Reward history (earnings log)

**Acceptance Criteria:**

- Rewards credited automatically on milestone
- Payouts processed within 7 days
- Fraud detection (suspicious patterns blocked)

---

### 16.4 Fraud Detection

**Features:**

- [ ] Self-referral prevention (same IP, email domain)
- [ ] Duplicate account detection (email similarity)
- [ ] Suspicious activity alerts (admin notification)
- [ ] Manual review queue (flagged referrals)

**Acceptance Criteria:**

- Self-referrals blocked automatically
- Suspicious patterns flagged (not auto-blocked)
- Admin can approve/reject manually

---

### 16.5 Tester Accounts

**Features:**

- [ ] Tester flag (lifetime free plan)
- [ ] Tester benefits (all features unlocked)
- [ ] Tester badge (UI display)
- [ ] Tester analytics (usage metrics for product improvement)

**Acceptance Criteria:**

- Tester accounts never billed
- All features accessible (no restrictions)
- Admin can assign/revoke tester status

---

## üîÆ FUTURE FEATURES (v2.0+)

### 17. OAUTH PROVIDERS

**Features:**

- [ ] Google SSO
- [ ] GitHub SSO
- [ ] Microsoft SSO
- [ ] Apple Sign In
- [ ] Link/unlink accounts

---

### 18. MAGIC LINK LOGIN

**Features:**

- [ ] Passwordless login via email
- [ ] Time-limited magic link (15 min)
- [ ] One-time use only
- [ ] Fallback to password if expired

---

### 19. LIGHTNING NETWORK PAYMENTS

**Features:**

- [ ] Bitcoin Lightning integration
- [ ] Invoice generation (BOLT11)
- [ ] Payment verification (instant)
- [ ] BTC/USD conversion (real-time rate)
- [ ] Withdrawal to wallet

---

### 20. ADVANCED ANALYTICS

**Features:**

- [ ] Custom report builder (drag-drop)
- [ ] Data export (CSV, Excel, PDF)
- [ ] Scheduled reports (email delivery)
- [ ] Advanced visualizations (heatmaps, funnels, cohorts)
- [ ] BI tool integration (Metabase, Tableau)

---

### 21. MULTI-LANGUAGE (i18n)

**Features:**

- [ ] English (EN)
- [ ] Spanish (ES)
- [ ] Auto-detect locale (browser)
- [ ] User preference (manual selection)
- [ ] RTL support (Arabic, Hebrew)
- [ ] Translation management UI (admin can edit translations)

---

### 22. WHITE-LABELING

**Features:**

- [ ] Custom branding per tenant (logo, colors, fonts)
- [ ] Email template customization
- [ ] Custom domain support (tenant.com)
- [ ] Favicon customization
- [ ] Custom CSS injection

---

### 23. API MARKETPLACE

**Features:**

- [ ] Public API documentation
- [ ] API key generation (per tenant)
- [ ] Rate limiting dashboard (quotas, usage)
- [ ] API analytics (endpoints, latency, errors)
- [ ] Webhook management

---

## üìä FEATURE PHASES MATRIX

|Feature|MVP|POST-MVP|FUTURE|
|---|---|---|---|
|Auth (Email/Password)|‚úÖ|||
|Auth (OAuth)|||‚úÖ|
|Auth (Magic Link)|||‚úÖ|
|Multi-Tenant|‚úÖ|||
|RBAC|‚úÖ|||
|Admin Panel|‚úÖ|||
|Payments (Stripe)|‚úÖ|||
|Payments (Pix)|‚úÖ|||
|Payments (Lightning)|||‚úÖ|
|CRM||‚úÖ||
|Invoicing||‚úÖ||
|Orders|‚úÖ|‚úÖ||
|Jobs||‚úÖ||
|Tours/Booking||‚úÖ||
|File Manager||‚úÖ||
|Chat||‚úÖ||
|Mail||‚úÖ||
|Referral||‚úÖ||
|Analytics (Basic)|‚úÖ|||
|Analytics (Advanced)|||‚úÖ|
|Observability|‚úÖ|||
|i18n (PT-BR)|‚úÖ|||
|i18n (EN, ES)|||‚úÖ|
|White-labeling|||‚úÖ|
|API Marketplace|||‚úÖ|

---

## ‚úÖ ACCEPTANCE CRITERIA

### MVP Completion Criteria

**Code Quality:**

- [ ] 100% TypeScript (no `any` types in production code)
- [ ] 80%+ test coverage (unit + integration)
- [ ] ESLint passes (0 errors, 0 warnings)
- [ ] Prettier formatted (consistent style)
- [ ] No console.log in production (use Winston)

**Performance:**

- [ ] API response time < 200ms (p95)
- [ ] Page load time < 1s (Lighthouse)
- [ ] Database queries optimized (explain analyze)
- [ ] Redis caching implemented (sessions, rate limiting)

**Security:**

- [ ] OWASP Top 10 mitigated
- [ ] Security headers configured (CSP, CORS, HSTS)
- [ ] Secrets never committed (gitignore enforced)
- [ ] Dependency vulnerabilities 0 (npm audit)
- [ ] Penetration test passed (manual review)

**Documentation:**

- [ ] README complete (setup, usage, architecture)
- [ ] API docs auto-generated (Swagger)
- [ ] All env variables documented (.env.example)
- [ ] Deployment guide complete (Docker, Railway, Vercel)
- [ ] Contributing guide complete (how to contribute)

**User Experience:**

- [ ] Mobile responsive (tested on iOS, Android)
- [ ] Accessible (WCAG AA compliance)
- [ ] Dark mode works (all pages)
- [ ] Error messages user-friendly (not technical jargon)
- [ ] Loading states everywhere (no blank screens)

**Deployment:**

- [ ] Docker production build works
- [ ] CI/CD pipeline green (all tests pass)
- [ ] Environment variables configurable
- [ ] Database migrations automatic
- [ ] Rollback tested (can revert deploy)

---

## üö´ OUT OF SCOPE

### Not Included (Intentionally)

**Mobile Apps:**

- Native iOS/Android apps (Future: React Native)
- Reason: Web-first, mobile-responsive is sufficient for MVP

**Advanced AI Features:**

- ChatGPT integration, AI chatbots, AI content generation
- Reason: Not core to boilerplate, can be added by cloners

**E-commerce Features:**

- Shopping cart, product catalog, checkout flow
- Reason: Too vertical-specific, not generic enough

**Marketing Automation:**

- Email campaigns, A/B testing, marketing funnels
- Reason: Use existing tools (Mailchimp, SendGrid)

**Video Conferencing:**

- Built-in video calls (Zoom alternative)
- Reason: Use external APIs (Twilio, Agora)

**Social Network Features:**

- User posts, likes, comments, feeds
- Reason: Too vertical-specific

**Blockchain/Web3 (MVP):**

- NFT minting, DAO governance, smart contracts
- Reason: Niche use case, Future module

---

## üìù CHANGELOG

### v1.0.0 (December 16, 2025)

- Initial scope document created
- MVP features defined (6 weeks timeline)
- POST-MVP features documented (8-12 weeks)
- FUTURE features outlined (v2.0+ roadmap)
- Acceptance criteria established
- Out of scope clarified

---

**Next Document:** `ARCHITECTURE.md` (technical architecture decisions)